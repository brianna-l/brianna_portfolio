<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MindAR Debug Starter</title>
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000;}
    #start{position:fixed;inset:auto 0 0 0;margin:auto;width:max-content;padding:12px 16px;background:#fff;border:0;border-radius:12px;cursor:pointer;font:600 16px/1 system-ui}
    #log{position:fixed;top:0;left:0;right:0;background:rgba(0,0,0,.6);color:#0f0;font:12px/1.4 ui-monospace,monospace;max-height:40vh;overflow:auto;white-space:pre-wrap;padding:8px;display:none}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-three.prod.js"></script>
</head>
<body>
  <button id="start">Start AR</button>
  <div id="log"></div>
  <script>
    const logBox = document.getElementById('log');
    const log = (...a)=>{ logBox.style.display='block'; logBox.textContent += a.join(' ') + '\n'; console.log(...a); };
    window.addEventListener('error', e => log('JS Error:', e.message));
    window.addEventListener('unhandledrejection', e => log('Promise Rejection:', e.reason?.message || e.reason));

    document.getElementById('start').addEventListener('click', async () => {
      try {
        // Basic feature checks
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          log('No camera API (https or permissions issue).'); return;
        }
        const mindar = new window.MINDAR.IMAGE.MindARThree({
          container: document.body,
          imageTargetSrc: './targets.mind', // make sure this path is correct
        });

        const { renderer, scene, camera } = mindar;
        scene.add(new THREE.AmbientLight(0xffffff, 1));

        // simple white plate to verify tracking
        const anchor = mindar.addAnchor(0);
        const plate = new THREE.Mesh(
          new THREE.PlaneGeometry(0.06, 0.06),
          new THREE.MeshBasicMaterial({ color: 0xffffff, transparent:true, opacity:0.8 })
        );
        plate.rotation.x = -Math.PI/2;
        anchor.group.add(plate);

        anchor.onTargetFound = ()=> log('Target FOUND');
        anchor.onTargetLost  = ()=> log('Target LOST');

        // start AR (triggers camera prompt)
        await mindar.start();
        log('MindAR started.');
        document.getElementById('start').remove();

        const clock = new THREE.Clock();
        renderer.setAnimationLoop(() => {
          const dt = clock.getDelta(); // keep in case you animate later
          renderer.render(scene, camera);
        });

        // extra: confirm targets.mind actually loads (shows size)
        fetch('./targets.mind').then(r=>{ log('targets.mind HTTP', r.status, r.statusText); return r.blob(); })
                               .then(b=>log('targets.mind size', b.size,'bytes'))
                               .catch(err=>log('targets.mind fetch error', err.message));

      } catch (err) {
        log('Start failed:', err.message || err);
      }
    });
  </script>
</body>
</html>
